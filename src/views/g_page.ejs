<!DOCTYPE html>
<html lang="en">
  <!-- Header -->
  <%- include('layouts/header'); -%>
  <body>
    <!-- Navbar -->
    <%- include('layouts/navbar'); -%>

    <!-- Main Content -->

    <main class="g-page-main-div-style">
      <div class="background-container">
        <div class="overlay-style"></div>
        <div class="content-wrapper">
          <!-- Introductory Text -->
          <div class="intro-text">
            <h1>Welcome to the G Test Data Retrieval Portal</h1>
            <h3>
              Enter your License Number below to retrieve your details from the
              database.
            </h3>
          </div>
        </div>
      </div>
      <div class="g-page-container">
        <div class="g-page-form-container">
          <h2 class="text-center">Retrieve Your Information</h2>

          <form
            class="g-page-form"
            id="gPageForm"
            action="/user-data"
            method="POST"
            novalidate
          >
            <div class="form-group">
              <label for="licenseNumber">License Number</label>
              <input
                type="text"
                class="form-control"
                id="licenseNumber"
                name="licenseNumber"
                placeholder="A1234-56789-12345"
                minlength="17"
                maxlength="17"
                pattern="[A-Za-z]\d{4}-\d{5}-\d{5}"
                title="License number must be exactly 15 alphanumeric characters."
                required
              />
              <span id="licenseError" class="error-message"></span>
            </div>

            <!-- Submit Button -->
            <div class="text-center mt-2">
              <button type="submit" class="button">Retrieve Data</button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <%- include('layouts/footer'); -%> <%- include('layouts/scripts'); -%>
  </body>

  <script>
    // Function to format license number with dashes
    function formatLicenseNumber(input) {
      const cleaned = input.value.replace(/[^A-Za-z0-9]/g, "");

      let formatted = cleaned;

      if (cleaned.length > 5) {
        formatted = cleaned.slice(0, 5) + "-" + cleaned.slice(5);
      }
      if (cleaned.length > 11) {
        formatted = formatted.slice(0, 11) + "-" + formatted.slice(11);
      }

      input.value = formatted;
    }

    // Event listener for input formatting
    const licenseNumberInput = document.getElementById("licenseNumber");

    licenseNumberInput.addEventListener("input", function () {
      formatLicenseNumber(licenseNumberInput);
    });

    document.addEventListener("DOMContentLoaded", () => {
      const gPageForm = document.getElementById("gPageForm");

      gPageForm.addEventListener("submit", function (e) {
        let isValid = true;

        const clearErrors = () => {
          document.querySelectorAll(".error-message").forEach((error) => {
            error.textContent = "";
          });
        };

        clearErrors();

        const ontarioLicensePattern = /^[A-Za-z]\d{4}-\d{5}-\d{5}$/;
        const licenseNumber = document.getElementById("licenseNumber");

        const alphanumericOnly = licenseNumber.value.replace(
          /[^A-Za-z0-9]/g,
          ""
        );
        const alphanumericLength = alphanumericOnly.length;

        // Validate alphanumeric length
        if (alphanumericLength < 15) {
          document.getElementById("licenseError").textContent =
            "License number must contain 15 alphanumeric characters.";
          isValid = false;
        } else if (!ontarioLicensePattern.test(licenseNumber.value)) {
          document.getElementById("licenseError").textContent =
            "License number must be in the format: A1234-56789-12345.";
          isValid = false;
        }

        if (!isValid) {
          e.preventDefault();
        }
        // else {
        //   alert("Your request has been submitted successfully!");
        // }
      });
    });
  </script>
</html>
